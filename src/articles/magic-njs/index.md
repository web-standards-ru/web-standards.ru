---
title: '–ú–∞–≥–∏—è –≤–Ω–µ –•–æ–≥–≤–∞—Ä—Ç—Å–∞: NJS'
date: 2021-06-17
author: igor-korovchenko
editors:
    - vadim-makeev
    - nikita-dubko
    - andrey-melikhov
tags:
    - js
---

–ù–∞–≤–µ—Ä–Ω—è–∫–∞ –≤—ã¬†—Å–ª—ã—à–∞–ª–∏ –ø—Ä–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä [Nginx](https://nginx.org/) –ò–≥–æ—Ä—è –°—ã—Å–æ–µ–≤–∞. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Nginx –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç¬†–Ω–µ—Å–º–µ—Ç–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤. –°–ª–æ–≤–æ–º, –Ω–∞—Å—Ç–æ—è—â–∞—è –º–∞–≥–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞¬†—á–∏—Å—Ç–æ–º¬†–°–∏! –ï—Å–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É¬†–º–Ω–æ–≥–∏—Ö –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Å–∏–Ω–¥—Ä–æ–º —Å–∞–º–æ–∑–≤–∞–Ω—Ü–∞. –ò¬†–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ Nginx, –Ω–∞–¥–æ –ø—Ä–æ–π—Ç–∏ —à–∫–æ–ª—É —á–∞—Ä–æ–¥–µ–π—Å—Ç–≤–∞ –∏¬†–º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞. –ê¬†—á—Ç–æ –¥–µ–ª–∞—Ç—å JS-–≤–æ–ª—à–µ–±–Ω–∏–∫–∞–º –∏¬†JS-–≤–æ–ª—à–µ–±–Ω–∏—Ü–∞–º? –ú–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –∫—É—Ä—Å –∑–∞—â–∏—Ç—ã –æ—Ç¬†—Ç—ë–º–Ω—ã—Ö —Å–∏–ª –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ–±¬†[NJS](https://github.com/nginx/njs).

## –ê–ª–æ—Ö–æ–º–æ—Ä–∞: –æ—Ç–∫—Ä–æ–µ–º –∑–∞–º–æ—á–µ–∫

Nginx –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤¬†—Ä–∞–Ω—Ç–∞–π–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å¬†—Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞, –Ω–æ¬†—ç—Ç–æ –±—ã–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞¬†–ø–æ–ø—É–ª—è—Ä–Ω–æ–º —Ç–æ–≥–¥–∞ —è–∑—ã–∫–µ Perl. –°–µ–≥–æ–¥–Ω—è –º–∞–ª–æ –∫—Ç–æ —É–º–µ–µ—Ç –ø–∏—Å–∞—Ç—å –Ω–∞¬†Perl: —Å–Ω–∞—á–∞–ª–∞ –µ–º—É –Ω–∞¬†—Å–º–µ–Ω—É –ø—Ä–∏—à—ë–ª PHP, –∞¬†–ø–æ—Ç–æ–º –±—ã–ª –ø–µ—Ä–∏–æ–¥, –∫–æ–≥–¥–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∏—á–µ–≥–æ –Ω–µ¬†–º–µ–Ω—è–ª–æ—Å—å –≤¬†—Å–∞–º–æ–º Nginx. –í¬†—Ç–æ¬†–∂–µ –≤—Ä–µ–º—è –≤¬†—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–∞–±–∏—Ä–∞–ª–∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏ –∏¬†–≤—Å—ë –º–µ–Ω—å—à–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤ –º–æ–≥–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞¬†—Å–µ—Ä–≤–µ—Ä–µ. –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –≤–æ–∑–Ω–∏–∫–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ.

–ò¬†–≤–æ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Å¬†2017 –≥–æ–¥–∞ –æ–¥–Ω–∞ –∏–∑¬†–∫–æ–º–∞–Ω–¥ Nginx –Ω–∞—á–∞–ª–∞ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ¬†‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ JavaScript –≤¬†–∫–∞—á–µ—Å—Ç–≤–µ —è–∑—ã–∫–∞ –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤. –ë—ã–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–≤–∞ –º–æ–¥—É–ª—è –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Nginx, –∫–æ—Ç–æ—Ä—ã–µ –≤–º–µ—Å—Ç–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –æ—Å–Ω–æ–≤—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ NJS, –∏¬†–º–Ω–æ–≥–æ —á–µ–≥–æ –µ—â—ë –¥–ª—è –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Nginx Plus.

NJS¬†‚Äî –æ—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –£¬†–∫–æ–º–∞–Ω–¥—ã –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–≤–∏–∂–∫–∏ V8 –∏–ª–∏ SpiderMonkey, –Ω–æ¬†–æ–Ω–∏ –ø–æ—à–ª–∏ –¥—Ä—É–≥–∏–º –ø—É—Ç—ë–º. –≠—Ç–∏ —Ä–µ—à–µ–Ω–∏—è –Ω—É–∂–Ω—ã –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —à–∏—Ä–æ–∫–æ–≥–æ –∫—Ä—É–≥–∞ –∑–∞–¥–∞—á. –û¬†—Å–ª–æ–∂–Ω–æ—Å—Ç—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–≤–∏–∂–∫–æ–≤ JavaScript –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤¬†Nginx –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç –æ–¥–∏–Ω –∏–∑¬†–∞–≤—Ç–æ—Ä–æ–≤ NJS –≤¬†–¥–æ–∫–ª–∞–¥–∞—Ö –Ω–∞¬†[—Ä—É—Å—Å–∫–æ–º](https://youtu.be/GlJHbyvCMyk) –∏¬†[–∞–Ω–≥–ª–∏–π—Å–∫–æ–º](https://youtu.be/Jc_L6UffFOs) —è–∑—ã–∫–µ –∏¬†–ø—Ä–∏–≤–æ–¥–∏—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ NJS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏—é –≤¬†–±–∞–π—Ç-–∫–æ–¥ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Nginx: –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –∫–ª–æ–Ω–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –∞¬†–µ—â—ë –Ω–µ—Ç JIT-–∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏¬†—Å–±–æ—Ä—â–∫–∏ –º—É—Å–æ—Ä–∞. –°–∫—Ä–∏–ø—Ç—ã –ø–æ–¥ NJS –∏–Ω–æ–≥–¥–∞ –≤–ø–æ–ª–Ω–µ –º–æ–≥—É—Ç –∑–∞–º–µ–Ω–∏—Ç—å –º–æ–¥—É–ª–∏ Nginx –Ω–∞¬†—è–∑—ã–∫–µ –°–∏, —Ö–æ—Ç—è –∏¬†—Å¬†–Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–æ—Å–∞–¥–∫–æ–π –ø–æ¬†–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ü—Ä–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ NJS –±—ã–ª–æ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã Nginx –Ω–µ¬†–ø–æ—Ç–µ—Ä—è–ª —Å–≤–æ–∏—Ö –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤. –ò¬†–∫–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–∑¬†Nginx —Å–¥–µ–ª–∞–ª–∞¬†—ç—Ç–æ!

## –ü–æ—Ä—Ç—É—Å: –ø–æ—Ä–∞ –≤¬†–Ω–æ–≤—ã–π –º–∏—Ä

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ NJS –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –æ–ø–∏—Å–∞–Ω–∞ –≤¬†[–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://nginx.org/ru/docs/njs/install.html). –í–æ–∑–º–æ–∂–Ω—ã –∫–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤¬†–∫–∞—á–µ—Å—Ç–≤–µ –≥–æ—Ç–æ–≤–æ–≥–æ –ø–∞–∫–µ—Ç–∞, —Ç–∞–∫ –∏¬†—Å–±–æ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π –∏–∑¬†–∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å¬†NJS –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª—è: `ngx_http_js_module` –∏¬†`ngx_stream_js_module`. –ü–µ—Ä–≤—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ¬†–ø—Ä–æ—Ç–æ–∫–æ–ª—É HTTP, –≤—Ç–æ—Ä–æ–π¬†‚Äî –ø–æ¬†–ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º TCP –∏ UDP.

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª–∏ NJS –∫¬†Nginx. –ú–æ–¥—É–ª–∏ —è–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏, –ø–æ—ç—Ç–æ–º—É –≤¬†—Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è [–¥–∏—Ä–µ–∫—Ç–∏–≤–æ–π `load_module`](https://nginx.org/ru/docs/ngx_core_module.html#load_module "load_module"):

```
load_module modules/ngx_http_js_module.so;
# –∏–ª–∏
load_module modules/ngx_stream_js_module.so;
```

## –õ—é–º–æ—Å: —á—Ç–æ-—Ç–æ —Ç–µ–º–Ω–æ

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è Nginx, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –≤¬†—Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ó–¥–µ—Å—å –∏¬†–¥–∞–ª—å—à–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±—É–¥–µ–º –æ–ø–∏—Å—ã–≤–∞—Ç—å –≤¬†—Ñ–∞–π–ª–µ `nginx.conf`, –∞¬†—Å–∫—Ä–∏–ø—Ç –Ω–∞¬†—è–∑—ã–∫–µ [NJS](https://nginx.org/ru/docs/njs/index.html)¬†‚Äî –≤¬†—Ñ–∞–π–ª–µ `script.js`.

–ù–∞—á–Ω—ë–º —Å¬†–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ ¬´Hello world!¬ª. –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤¬†—Ç–æ–º, —á—Ç–æ–±—ã –ø—Ä–æ—Å–ª—É—à–∏–≤–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä 8080, –∏¬†–ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫¬†–∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ —Å–∞–π—Ç–∞ –æ—Ç–æ—Å–ª–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É –æ—Ç–≤–µ—Ç —Å¬†–∫–æ–¥–æ–º 200 –∏¬†–Ω–∞—à–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

–§–∞–π–ª `nginx.conf`:

```
http {
    js_import script.js;

    server {
        listen 8080;

        location / {
            js_content script.hello;
        }
    }
}
```

–§–∞–π–ª `script.js`:

```js
function hello(r) {
    r.return(200, 'Hello world!');
}

export default {
    hello
};
```

NJS¬†‚Äî —ç—Ç–æ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ JavaScript. –ß—Ç–æ –º–æ–∂–Ω–æ, –∞¬†—á—Ç–æ –Ω–µ–ª—å–∑—è, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ [–¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç–æ–π](https://nginx.org/ru/docs/njs/compatibility.html). –Ø–∑—ã–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç [ECMA-262](https://www.ecma-international.org/ecma-262/) –∏¬†–∏–º–µ–µ—Ç [—Ä—è–¥ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∏¬†—Å–≤–æ–π—Å—Ç–≤](https://nginx.org/en/docs/njs/reference.html).

–°—Ä–µ–¥–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Å—É—â–Ω–æ—Å—Ç–∏ Nginx¬†‚Äî HTTP-–∑–∞–ø—Ä–æ—Å, Stream-—Å–µ—Å—Å–∏—è. –ú–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –º–µ—Ç–æ–¥ –∏¬†–∞—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞–ø—Ä–æ—Å–∞, –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏¬†—Ç–µ–ª–æ HTTP-—Å–æ–æ–±—â–µ–Ω–∏—è, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥—ã –æ—Ç–≤–µ—Ç–∞, –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Ç–µ–ª–æ HTTP-–æ—Ç–≤–µ—Ç–∞ –æ—Ç¬†—Å–µ—Ä–≤–µ—Ä–∞. –í–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–æ—Å—Ç—É–ø–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫. –°–æ–∑–¥–∞—Ç—å –∏¬†–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–∂–µ –≤–æ–∑–º–æ–∂–Ω–æ —Å¬†–ø–æ–º–æ—â—å—é NJS. –¢–∞–π–º–µ—Ä—ã, –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ-–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ¬†–ø—Ä–æ—Ü–µ—Å—Å–µ, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —è–≤–ª—è—é—Ç—Å—è —á–∞—Å—Ç—å—é —è–¥—Ä–∞, –∞¬†—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–æ—Ä –∏¬†—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ URL, –¥–æ—Å—Ç—É–ø –∫¬†—Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ —á–µ—Ä–µ–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `fs`¬†‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏.

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–∏–≤–µ–ª–∏ –¥–æ–≤–æ–ª—å–Ω–æ –º–Ω–æ–≥–æ [–ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞ –∏¬†–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](https://nginx.org/ru/docs/njs/examples.html) NJS. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–π–¥–∏—Ç–µ –Ω–∞¬†—ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É¬†‚Äî –≤–¥—Ä—É–≥ –≤–∞—à –≤–∞—Ä–∏–∞–Ω—Ç —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.

–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤ NJS –¥–ª—è –≤–µ—Ä—Å–∏–∏ 0.4.0 –∏¬†—Å—Ç–∞—Ä—à–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤¬†—Ñ–∞–π–ª–∞—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

- [`js_body_filter`](https://nginx.org/ru/docs/http/ngx_http_js_module.html#js_body_filter)¬†‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∏–∑¬†–º–æ–¥—É–ª—è –≤¬†–∫–∞—á–µ—Å—Ç–≤–µ —Ñ–∏–ª—å—Ç—Ä–∞ —Ç–µ–ª–∞ HTTP-—Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞;
- [`js_content`](https://nginx.org/ru/docs/http/ngx_http_js_module.html#js_content "js_content")¬†‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∏–∑¬†–º–æ–¥—É–ª—è –≤¬†–∫–∞—á–µ—Å—Ç–≤–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `location`;
- [`js_header_filter`](https://nginx.org/ru/docs/http/ngx_http_js_module.html#js_header_filter "js_header_filter")¬†‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∏–∑¬†–º–æ–¥—É–ª—è –≤¬†–∫–∞—á–µ—Å—Ç–≤–µ —Ñ–∏–ª—å—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ HTTP-—Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞;
- [`js_import`](https://nginx.org/ru/docs/http/ngx_http_js_module.html#js_import "js_import")¬†‚Äî –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–æ–¥—É–ª—å —Å¬†—Ñ—É–Ω–∫—Ü–∏—è–º–∏;
- [`js_path`](https://nginx.org/ru/docs/http/ngx_http_js_module.html#js_path "js_path")¬†‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–æ¬†–º–æ–¥—É–ª–µ–π;
- [`js_set`](https://nginx.org/ru/docs/http/ngx_http_js_module.html#js_set "js_set")¬†‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∏–∑¬†–º–æ–¥—É–ª—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤¬†–º–æ–º–µ–Ω—Ç –ø–µ—Ä–≤–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫¬†–ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞;
- [`js_var`](https://nginx.org/ru/docs/http/ngx_http_js_module.html#js_var "js_var")¬†‚Äî –æ–±—ä—è–≤–ª—è–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

## –í–∏–Ω–≥–∞—Ä–¥–∏—É–º –õ–µ–≤–∏–æ—Å–∞: –ø–æ–ª–µ—Ç–µ–ª–∏

–¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–µ–º –Ω–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ üôÉ. –í–æ–∑—å–º—ë–º —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏¬†–ø–æ–ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏¬†–ø—Ä–∏–Ω–∏–º–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å¬†–ø–æ–º–æ—â—å—é –Ω–µ–≥–æ. –ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π [—à–∏—Ñ—Ä –¶–µ–∑–∞—Ä—è](https://ru.wikipedia.org/wiki/–®–∏—Ñ—Ä_–¶–µ–∑–∞—Ä—è). –ï–≥–æ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤¬†—Ç–æ–º, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –≤¬†—Å–æ–æ–±—â–µ–Ω–∏–∏ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞¬†–¥—Ä—É–≥–æ–π, —Å–¥–≤–∏–Ω—É—Ç—ã–π —Ü–∏–∫–ª–∏—á–Ω–æ –Ω–∞¬†—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–∑–∏—Ü–∏–π –≤¬†–∞–ª—Ñ–∞–≤–∏—Ç–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–≤–æ `JavaScript` –±—É–¥–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –≤¬†—Å–ª–æ–≤–æ `OfafXhwnuy` –ø—Ä–∏ —Å–º–µ—â–µ–Ω–∏–∏ –Ω–∞¬†–ø—è—Ç—å —Å–∏–º–≤–æ–ª–æ–≤.

–ù–∞–ø–∏—à–µ–º —Å–Ω–∞—á–∞–ª–∞ –∫–æ–¥, –∏—Å–ø–æ–ª—å–∑—É—è NJS. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏¬†–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑—É–µ–º –≤¬†—Ñ—É–Ω–∫—Ü–∏–∏ `processMessage()` (–¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ —É—á—Ç—ë–º —Ç–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª—ã –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞, –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–¥–≤–∏–≥–∞, –∞¬†–¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è¬†‚Äî –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ).

–ü–æ–ø—Ä–æ–±—É–µ–º —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –ø—Ä–∏ –ø—Ä–∏—ë–º–µ HTTP-–∑–∞–ø—Ä–æ—Å–∞ —Å–∫—Ä–∏–ø—Ç –≤–æ–∑–≤—Ä–∞—â–∞–ª —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ-–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤¬†–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç¬†–ø—É—Ç–∏ –Ω–∞¬†—Å–µ—Ä–≤–µ—Ä–µ `/encode/` –∏–ª–∏ `/decode/`. –ï—Å–ª–∏ –º—ã¬†–æ–±—Ä–∞—Ç–∏–º—Å—è –∫¬†`/shift/`, —Ç–æ¬†–ø–æ–ª—É—á–∏–º —Å–¥–≤–∏–≥, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ª–æ–∂–µ–Ω –≤¬†–Ω–∞—à—É –ø—Ä–æ–≥—Ä–∞–º–º—É. –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏ –Ω–∞–ø–∏—à–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤¬†–º–æ–¥—É–ª–µ: `encode`, `decode` –∏¬†`shift`. –°¬†–ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `getMessage()` –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑¬†–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö GET- –∏–ª–∏ POST-–∑–∞–ø—Ä–æ—Å–æ–º –æ—Ç¬†–∫–ª–∏–µ–Ω—Ç–∞.

–ú–æ–¥—É–ª–∏ NJS –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –∏¬†–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞¬†—Å–µ—Ä–≤–µ—Ä–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∞¬†–∑–∞—Ç–µ–º —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –í¬†–ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Nginx Plus –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤¬†–æ–±—â–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –í¬†–Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –º—ã¬†–º–æ–≥–ª–∏¬†–±—ã —Ç–∞–∫ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤–µ–ª–∏—á–∏–Ω—É —Å–¥–≤–∏–≥–∞. –ù–æ¬†—É¬†–Ω–∞—Å –≤–µ—Ä—Å–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è, –ø–æ—ç—Ç–æ–º—É –º—ã¬†—Ö—Ä–∞–Ω–∏–º –≤–µ–ª–∏—á–∏–Ω—É —Å–¥–≤–∏–≥–∞ –≤¬†–∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ `CAESAR_SHIFT`. –í¬†–ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Nginx Plus –µ—Å—Ç—å –¥–∞–∂–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–æ–≤, –Ω–∞–º¬†–±—ã –≤—Ä—è–¥¬†–ª–∏ —ç—Ç–æ –ø—Ä–∏–≥–æ–¥–∏–ª–æ—Å—å, –Ω–æ¬†–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ.

–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å `script.js` –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```js
const CAESAR_SHIFT = 5;

// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (—à–∏—Ñ—Ä –¶–µ–∑–∞—Ä—è)
function processMessage(inputString, shift) {
    let outputString = '';
    // –ë–µ–∂–∏–º –ø–æ –≤—Å–µ–º —Å–∏–º–≤–æ–ª–∞–º —Å—Ç—Ä–æ–∫–∏
    for (let i = 0; i < inputString.length; i++) {
        // –ü–æ–ª—É—á–∞–µ–º —Å–∏–º–≤–æ–ª —Å—Ç—Ä–æ–∫–∏
        let c = inputString[i];
        if (c.match(/[a-z]/i)) {
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ —Å–∏–º–≤–æ–ª–∞
            const code = inputString.charCodeAt(i);
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–æ–ø–∏—Å–Ω—ã–µ –±—É–∫–≤—ã
            if (code >= 65 && code <= 90) {
                c = String.fromCharCode(((code - 65 + shift) % 26) + 65);
            }
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã
            else if (code >= 97 && code <= 122) {
                c = String.fromCharCode(((code - 97 + shift) % 26) + 97);
            }
        }
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –≤ –∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏
        outputString += c;
    }
    return outputString;
}

// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
function getMessage(r) {
    return r.args.msg;
}

// –®–∏—Ñ—Ä—É–µ–º
function encode(r) {
    r.return(200, processMessage(getMessage(r), CAESAR_SHIFT));
}

// –î–µ—à–∏—Ñ—Ä—É–µ–º
function decode(r) {
    r.return(200, processMessage(getMessage(r), -CAESAR_SHIFT));
}

// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–¥–≤–∏–≥
function shift(r) {
    r.return(200, CAESAR_SHIFT);
}

export default {
    encode,
    decode,
    shift
};
```

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤¬†NJS –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —è–∑—ã–∫–∞ JavaScript –æ–ø–∏—Å–∞–Ω –Ω–∞¬†—Å—Ç—Ä–∞–Ω–∏—Ü–µ ¬´[–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å](https://nginx.org/ru/docs/njs/compatibility.html)¬ª.

–ö–æ–º–∞–Ω–¥–∞ `r.return()`¬†‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–ª–æ HTTP-—Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É –∏¬†—Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞. `r.variables` —Ö—Ä–∞–Ω–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –≤¬†–∑–∞–ø—Ä–æ—Å–µ –∫–ª–∏–µ–Ω—Ç–∞. –ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω—É–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤¬†–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å¬†–º–æ–¥—É–ª—è–º–∏ –≤¬†JavaScript.

–ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞ –≥–æ—Ç–æ–≤–∞, —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–∏–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.

–£¬†Nginx –µ—Å—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ Docker. –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞—à –∫–æ–¥, –≤—ã¬†–º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É (–µ—Å–ª–∏ —É¬†–≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏¬†–Ω–∞—Å—Ç—Ä–æ–µ–Ω [Docker](https://www.docker.com/get-started)):

```bash
docker run -i -t nginx:mainline /usr/bin/njs
```

–¢–∞–∫ –≤—ã¬†–º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –∫–æ–¥–∞, –≤—Å—Ç–∞–≤–ª—è—è —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ. –ï—Å–ª–∏ –±–µ–∑ Docker, —Ç–æ¬†–≤—ã¬†–º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –Ω–∞–ø—Ä—è–º—É—é, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ [CLI-—É—Ç–∏–ª–∏—Ç—É](https://nginx.org/ru/docs/njs/cli.html) –Ω–∞¬†–∫–æ–º–ø—å—é—Ç–µ—Ä –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä. –≠—Ç–æ –ø–æ¬†—Å—É—Ç–∏ —Ç–æ—Ç¬†–∂–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤¬†–º–æ–¥—É–ª–µ Nginx.

–£—Å—Ç–∞–Ω–æ–≤–∏–º Nginx –∏¬†NJS. –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å—Ç–∞–≤–∏—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –±—ã–ª–æ —É–¥–æ–±–Ω–µ–µ, —É—Å—Ç–∞–Ω–æ–≤–∏–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –¢–∞–∫ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å¬†–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º, –∫–∞–∫ —Å¬†—É–¥–∞–ª—ë–Ω–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º, –∞¬†–∫–ª–∏–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç –≤—ã—Å—Ç—É–ø–∞—Ç—å –Ω–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä. –í—ã¬†–º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –∏–Ω–∞—á–µ, –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –≤—Å—ë, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –∫¬†—Å–µ–±–µ –Ω–∞¬†–∫–æ–º–ø—å—é—Ç–µ—Ä –∏–ª–∏ –Ω–∞¬†—Å–µ—Ä–≤–µ—Ä. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ¬†Docker –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å –≤¬†—Ü–∏–∫–ª–µ —Å—Ç–∞—Ç–µ–π ¬´[–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ Docker](https://web-standards.ru/articles/docker-unboxing-1/)¬ª.

–°–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É —Å¬†–ø—Ä–æ–µ–∫—Ç–æ–º –∏¬†–ø–µ—Ä–µ–π–¥–µ–º –≤¬†–Ω–µ—ë:

```bash
mkdir caesar
cd caesar
```

–°–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É –¥–ª—è –∫–æ–¥–∞ –∏¬†–¥–æ–±–∞–≤–∏–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç —Å¬†–ø–æ–º–æ—â—å—é —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∏–ª–∏ –∫–æ–º–∞–Ω–¥–æ–π `cat`:

```bash
mkdir src
cat > ./src/script.js << __EOF__
// C–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ —Å–∫—Ä–∏–ø—Ç–∞
__EOF__
```

–î–æ–±–∞–≤–∏–º –µ—â—ë –ø—Ä–æ—Å—Ç–µ–π—à–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤¬†—Ñ–∞–π–ª–µ `index.html`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–µ—Å—Ç–∏–º –≤¬†–ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NJS —Ç–µ—Å—Ç</title>
</head>
<body>
    <form action="/encode/">
        <fieldset>
            <legend>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</legend>
            <label for="encode-message">–°–æ–æ–±—â–µ–Ω–∏–µ</label><br>
            <textarea id="encode-message" name="message" cols="30" rows="10"></textarea><br>
            <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
        </fieldset>
    </form>
    <form action="/decode/">
        <fieldset>
            <legend>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</legend>
            <label for="decode-message">–°–æ–æ–±—â–µ–Ω–∏–µ</legend><br>
            <textarea id="decode-message" name="message" cols="30" rows="10"></textarea><br>
            <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
        </fieldset>
    </form>
    <form action="/shift/">
        <fieldset>
            <legend>–ü–æ–ª—É—á–∏—Ç—å —Å–¥–≤–∏–≥</legend>
            <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
        </fieldset>
    </form>
</body>
</html>
```

–°–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É, –≤¬†–∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–∑–∞ –¥–ª—è Nginx (—Å—Å—ã–ª–∫–∞ –Ω–∞¬†–≥–æ—Ç–æ–≤—ã–π Dockerfile –¥–ª—è —Å–±–æ—Ä–∫–∏ –±–µ—Ä—ë–º –∏–∑¬†[–ø—Ä–∏–º–µ—Ä–∞ –≤¬†–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏](https://github.com/nginxinc/docker-nginx/tree/master/modules)):

```bash
mkdir nginx
curl -o nginx/Dockerfile https://raw.githubusercontent.com/nginxinc/docker-nginx/master/modules/Dockerfile
```

–°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `nginx.conf`:

```bash
touch ./nginx/nginx.conf
```

–ü–æ–º–µ—Å—Ç–∏–º –≤¬†—Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è Nginx:

```nginx
load_module modules/ngx_http_js_module.so;

events {}

http {
    js_path /etc/nginx/njs/;
    js_import script.js;

    server {
        listen 8080;

        root /var/www;

        location /encode/ {
            js_content script.encode;
        }

        location /decode/ {
            js_content script.decode;
        }

        location /shift/ {
            js_content script.shift;
        }
    }
}
```

–°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `docker-compose.yml`:

```bash
touch docker-compose.yml
```

–ù–∞–ø–æ–ª–Ω–∏–º –µ–≥–æ:

```yaml
version: "3.9"
services:
    web:
        build:
            context: ./nginx/
            args:
                ENABLED_MODULES: njs
        image: nginx-with-njs:v1
        volumes:
            - ./nginx/nginx.conf:/etc/nginx/nginx.conf
            - ./src/:/etc/nginx/njs/
            - ./index.html:/var/www/index.html
        ports:
            - "80:8080"
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞¬†–ø—É—Ç–∏ —Ç–æ–º–æ–≤ `volumes`. –í¬†–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–æ–º–∞ `binded volumes`, —Ç–æ¬†–µ—Å—Ç—å –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞¬†—Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –Ω–∞¬†–∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—â–µ–Ω Docker. –û–¥–Ω–∞–∫–æ —Å—Å—ã–ª–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏¬†—Å–∫—Ä–∏–ø—Ç –Ω—É–∂–Ω–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤¬†`/etc/nginx/` –∏¬†`/etc/nginx/njs/`, —Å–æ–æ—Ç–≤–µ—Å—Ç–≤–µ–Ω–Ω–æ. –í¬†–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `js_path`, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ¬†–ø–æ—Ç–µ—Ä—è–ª–æ—Å—å.

–û—Å—Ç–∞–ª–æ—Å—å –≤—Å—ë –∑–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
docker-compose up
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤¬†–±—Ä–∞—É–∑–µ—Ä–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—à–µ–π —Ä–∞–±–æ—Ç—ã –ø–æ¬†–∞–¥—Ä–µ—Å—É `http://localhost`. –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—á–µ—Ç–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à <kbd>Ctrl C</kbd> –∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–∏–≥–Ω–∞–ª –≤¬†Unix-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

## –ü—Ä–∏–æ—Ä–∏ –ò–Ω–∫–∞–Ω—Ç–∞—Ç–µ–º: —á—Ç–æ —ç—Ç–æ –±—ã–ª–æ

–î–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypeScript, –∫–∞–∫ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–æ –≤¬†[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://nginx.org/ru/docs/njs/typescript.html). –í¬†NJS [–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å](https://nginx.org/ru/docs/njs/node_modules.html) –º–æ–¥—É–ª–∏ Node.js. –ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ¬†—Å–æ—Å—Ç–∞–≤–∏—Ç –±–æ–ª—å—à–æ–≥–æ —Ç—Ä—É–¥–∞ —Å–¥–µ–ª–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å¬†–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º [gRPC](https://grpc.io/) —Å¬†–ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ [protobufjs](https://www.npmjs.com/package/protobufjs). –ß—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ [–ø—Ä–∏–º–µ—Ä—ã](https://github.com/xeioex/njs-examples) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ NJS.

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –Ω–µ¬†–Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –∫–æ–¥ –Ω–∞¬†–°–∏¬†–¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è Nginx, –∞¬†–ø–æ—Ç–æ–º –∫–æ–¥ –Ω–∞¬†JavaScript –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏¬†—Ç–æ—Ç¬†–∂–µ –º–æ–¥—É–ª—å. –í—ã, –∫–æ–Ω–µ—á–Ω–æ, –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞¬†Perl –∏–ª–∏ –Ω–∞¬†PHP, –Ω–æ¬†JavaScript –∏–Ω–æ–≥–¥–∞ –∏¬†–ø—Ä–∞–≤–¥–∞ —è–≤–ª—è–µ—Ç—Å—è –ª—É—á—à–∏–º —Ä–µ—à–µ–Ω–∏–µ–º. –ê¬†—Å–∫–æ—Ä–æ—Å—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –≤¬†—Å–ª—É—á–∞–µ NJS —Å—Ä–∞–≤–Ω–∏–º–∞ —Å¬†–∫–æ–¥–æ–º –Ω–∞¬†–°–∏, –ø–æ–º–Ω–∏—Ç–µ –æ–±¬†—ç—Ç–æ–º!
