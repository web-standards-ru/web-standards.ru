---
title: 'Поддержка Flutter Web теперь в stable'
date: 2021-03-15
author: mariam-hasnany
source:
    title: 'Flutter web support hits the stable milestone'
    url: https://medium.com/flutter/flutter-web-support-hits-the-stable-milestone-d6b84e83b425
translators:
    - igor-korovchenko
editors:
    - vadim-makeev
layout: article.njk
tags:
    - article
    - css
preview: 'Продукт-менеджер Google Марьям Асмани рассказывает о возможностях Flutter Web, который теперь можно использовать как таргет в ветке stable.'
---

![Поддержка Flutter Web теперь в stable](https://miro.medium.com/max/1920/1*bbkcrsggiQLxNDRAgHiSBQ.png)

Мы позиционируем Flutter как UI фреймворк для сборки красивых приложений на любой платформе. Сегодня мы анонсируем поддержку сборки веб-приложений во [Flutter 2](https://medium.com/flutter/whats-new-in-flutter-2-0-fe8e95ecc65).

Первая версия Flutter поддерживала только мобильные платформы (iOS и Android). И это позволило разработчикам загрузить в магазины AppStore и Google Play более ста пятидесяти тысяч приложений. Добавление сборки для веб-платформы означает не только то, что уже написанные приложения могут быть доступны более широкой аудитории, это означает появление новых способов взаимодействия с пользователем в вебе.

В этом релизе мы сфокусируемся на трех сценариях использования:

- **Прогрессивные веб-приложения (PWAs)**, которые можно запустить в браузере и на десктопе как обычные приложения.
- **Одностраничные приложения (SPAs)** — веб-приложения для браузера, которые грузятся один раз, а затем передают и получают в основном только данные.
- **Веб-версии существующих мобильных Flutter-приложений**, с единой кодовой базой для всех платформ.

Эта статья описывает то, что мы успели сделать на настоящий момент. Мы показываем на примерах, какие преимущества вы можете получить, используя поддержку веб-платформы в приложениях Flutter.

![iRobot Education разработало приложение iRobot Coding, которое использует Flutter, доступно в вебе, чтобы каждый мог поучится программировать](https://miro.medium.com/max/2732/0*yDQInopKQv6QR0Hb)

## Наше путешествие в веб

Сегодня веб-платформа богата как никогда: [поддержка графических ускорителей для 2D и 3D графики](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API), [поддержка работы приложений офлайн](https://web.dev/progressive-web-apps/) и [доступ к API операционной системы и железу устройства](https://web.dev/fugu-status/), на котором она установлена. Веб-приложения сегодня могут быть написаны на фреймворках, например ([React.js](https://reactjs.org/), [Angular](https://angular.io/), [Vue.js](https://vuejs.org/), [Flask](https://flask.palletsprojects.com/)), сборка с помощью которых осуществляется на собственной платформе. Это дает разработчикам гибкость в создании веб-приложений.

Поскольку Flutter написан на языке [Dart](https://dart.dev/), который из коробки поддерживает трансляцию в JavaScript, следующий шаг — использование Flutter для веба — был совершенно естественным.

Наш подход заключается в создании набора инструментов, которые одинаково хорошо работали бы для всех платформ. Это позволяет разработчику быть уверенным, что его код запустится без сюрпризов везде. Хотя можно было бы иметь и два фреймворка для сборки мобильных приложений и для сборки веб-приложений, незначительно отличающихся в поведении.

![Архитектура для поддержки Flutter в вебе](https://miro.medium.com/max/3200/0*ai8xTn_dMUTB6af6)

На уровне архитектуры, Flutter базируется на:

- **фреймворке на Dart**, который использует общие абстракции, такие как виджеты, анимации и жесты;
- **движке на C++**, который рендерит код для целевого устройства, используя системные API.

Сам Flutter написан на Dart, и около семисот тысяч строк кода используются для мобильной платформы, десктопа и веба. Код любого Flutter-приложения также написан на Dart: мы используем компилятор Dart для разработки мобильных приложений ([`dartdevc`](https://dart.dev/tools/dartdevc)) и транслятор Dart ([`dart2js`](https://dart.dev/tools/dart2js)) для перевода вашего кода в JavaScript, который, в свою очередь, может быть уже перенесен на сервер.

Благодаря поддежке трансляции программ на языке Dart в программы на JavaScript, наша работа сводилась лишь к замене низкоуровневого движка для рендеринга, написанного на C++, который ранее использовался только при рендеринге кода для мобильных приложений, на новый движок с поддержкой API веб-платформы. Теперь движок Flutter для веба предлагает использовать два варианта: рендеринг в оптимизированный HTML и рендеринг с помощью ConvasKit, который использует WebAssembly и WebGL для перевода команд движка Skia в команды рисования на канвасе в браузере. Flutter не умеет напрямую транспилировать виджеты в эквивалент на HTML.

Наша цель — предложить новый путь для веб-платформы, который улучшил бы пользовательский опыт.

## Путь к релизу в ветке stable

Так как наш [релиз с поддержкой веба в бета-ветке](https://medium.com/flutter/web-support-for-flutter-goes-beta-35b64a1217c0) был более года назад, мы получили много информации о том, как используют его разработчики. Мы работали с несколькими из них, использующими Flutter для веба в своих комммерческих приложениях.

С момента релиза мы сделали большую часть задуманных усовершенствований в архитектуре фреймворка и добавили новые возможности, которые расширяют и оптимизируют поддержку веб-платформы, фокусируясь на четырех областях: **производительности**, **возможности, специфические для веба**, **поддержке экранов десктопов** и **плагинах**.

![Возможности Flutter для веб-платформы, доступные в стабильной ветке](https://miro.medium.com/max/1920/1*eq4uks7XD1mMWrTQVTUY6w.png)

### Производительность

Большая часть работы с самых первых релизов была посвящена производительности. В процессе мы лучше разобрались в характеристиках производительности и корректности применения различных технологий, доступных в вебе.

Первоначально мы сосредоточились на DOM модели HTML. В ней веб-движок Flutter переводил сгенерированную сцену в HTML, CSS или Canvas и рендерил каждый кадр на страницу как дерево HTML-элементов. Даже несмотря на то, что движок для рендеринга HTML обеспечивал очень хорошую браузерную поддержку и имел малый размер, производительность для перерисовки была меньше, чем нужно для приложения с быстро менящейся графикой, наподобие [Rive](https://rive.app/) — инструмента для совместного создания анимаций, написанных на Flutter.

![Rive, инструмент для создания пользовательских анимаций, перестроил свое приложение с помощью Flutter в Интернете, и теперь оно доступно в бета-версии.](https://miro.medium.com/max/3200/0*kS0WlZkECsmnqaY7)

Держа в голове идею сделать качественный и эффективный с точки зрения графики движок для рендеринга, мы начали экспериментировать с [CanvasKit](https://skia.org/user/modules/canvaskit), который позволял рисовать в браузере с помощью команд Skia, используя [WebAssembly](https://webassembly.org/) и [WebGL](https://www.khronos.org/webgl/). Мы обнаружили, что CanvasKit может дать большую производительность, качество и точность отрисовки, используя графические ускорители. Вы можете посмотреть демо [Феликса Блашке](https://github.com/felixblaschke), талантливого участника Flutter-сообщества.

![Демо-версия Flutter Plasma, созданная Феликсом Блашке и работающая в Safari, Firefox, Edge и Chrome.](https://miro.medium.com/max/3200/0*PHaTJqBxdvTDycOh)

Flutter поддерживает два режима рендеринга, каждый из которых обладает преимуществами или недостатками, в зависимости от сценария использования:

- **Режим HTML.** Использует комбинацию HTML элементов, CSS, элементов на канвасе и SVG-элементов. Этот режим обеспечивает наименьший размер приложения.
- **Режим CanvasKit.** Движок полностью поддерживает возможности Flutter, доступные на мобильных платформах или десктопе, но добавляет 2 МБ к размеру веб-приложения.

Для оптимизации характеристик вашего веб-приложения на Flutter для всех устройств, режим рендеринга выбирается автоматически. Приложение по умолчанию запускается с помощью движка HTML в мобильных браузерах и с помощью CanvasKit в браузерах на десктопе. Вы можете использовать ключ `--web-renderer html` или `--web-renderer canvaskit` для прямого выбора режима рендеринга.

### Возможности, специфические для веба

Приложение на Flutter в браузере должно давать тот же пользовательский опыт, что и обычное веб приложение. Поэтому мы добавили во Flutter лучшее из мира веба.

Веб-платформа имеет много сильных сторон, одна из них — большое количество пользователей. Одна из многих причин обеспечить поддержку веб версии существующего Flutter-приложения — охватить пользователей за пределами магазинов мобильных приложений. Мы добавили поддержку роутинга с помощью ([URL-стратегий](https://flutter.dev/docs/development/ui/navigation/url-strategies)), чтобы ваши пользователи могли получить доступ до вашего приложения просто кликнув по ссылке.

![Демонстрационная страница Flutter Plasma demo - это пример плагина url_strategy, основанного на пользовательских URL-стратегиях Flutter, в действии.](https://miro.medium.com/max/3200/0*bf3e0LQ8MVQb0ETI)

Гиперссылки являются критически важным механизмом навигации в вебе. Новый [виджет `Link`](https://pub.dev/documentation/url_launcher/latest/link/Link-class.html) в пакете `url_launcher` позволяет использовать возможности навигации по якорям внутри вашего приложения и переходы на внешние вебсайты. Вы можете использовать `Link` в нужных вам виджетах, включая кнопки, встроенный текст, картинки, чтобы открывать ссылки в той же вкладке браузера или в новой.

Еще одной неотъемлемой частью приложения является рендеринг текста. Разработка системы верстки текста была одной из самых больших проблем для поддержки Flutter в вебе. Поскольку в вебе отсутствует специальное API для обработки элементов с текстом, Flutter должен измерять размеры абзаца (класс [`paragraph`](https://api.flutter.dev/flutter/dart-ui/Paragraph-class.html)), обращаясь к методу [`layout()`](https://api.flutter.dev/flutter/dart-ui/Paragraph/layout.html). Эти измерения могут серьезно повлиять на производительность, поэтому в новый [механизм измерения размеров текста на канвасе](https://github.com/flutter/flutter/issues/33523) добавлена поддержка двух вариантов текста: простого и форматированного. Сейчас Flutter позволяет измерять размеры в вебе эффективно, позволяя разное, например, рисовать выделение маркером в тексте.

Взаимодействие с текстом так же важно, как быстрый и точный рендеринг. Текст может быть выделен, скопирован и вставлен с помощью виджетов `SelectableText` и `EditableText`. Кроме того, текстовые поля формы поддерживают автоматическое заполнение с помощью класса [`AutofillGroup`](https://api.flutter.dev/flutter/widgets/AutofillGroup-class.html), который обращается к браузеру за пользовательскими данными, доступными для автозаполнения.

Flutter 2 частично поддерживает имплементацию прогрессивных веб-приложений (PWA). PWA — это простой и безопасный способ преодолеть разрыв между мобильными приложениями и веб-приложениями, поддерживаемый браузером Chrome ([проект Fugu](https://web.dev/fugu-status/))

![Invoice Ninja, приложение для управления счетами, запустило приложение PWA, используя ту же кодовую базу, что и существующие мобильные приложения Flutter.](https://miro.medium.com/max/3200/0*W5BGuCaX7v9rvtjh)

Когда вы создаете веб-приложение на Flutter, в сборку включается файл веб-манифеста для настройки PWA и описание сервис-воркеров. [Файл манифеста](https://developer.mozilla.org/en-US/docs/Web/Manifest) содержит метаданные о том, как приложение должно запускаться, включая информацию об иконках и названии приложения. [Сервис-воркеры](https://developers.google.com/web/ilt/pwa/introduction-to-service-worker) позволяют кэшировать ресурсы и запускать приложение офлайн. Когда Flutter-приложение будет запущено в браузере как PWA, пользователю будет доступна его установка на устройства, наряду с обычными приложениями на мобильном или десктопе.

### Поддержка экранов десктопов

Мы хотим, чтобы веб-приложение на Flutter работало правильно, несмотря на форму и размер окна браузера. В мобильных браузерах Flutter-приложения уже имеют великолепную поддержку жестов и скроллов, независимо от того, поддерживается ли это в мобильном приложении. Браузеры на десктопе предлагают другие способы взаимодействия пользователя с элементами интерфейса, и Flutter должен поддерживать их на уровне фреймворка.

Например, пользователь, при просмотре контента на десктопе ожидает отображение полос прокрутки, которыми можно управлять с помощью мышки и клавиатуры. Поэтому новые [интерактивные полосы прокрутки](http://flutter.dev/go/update-scrollbars) поддерживают темизацию [`ScrollbarTheme`](https://api.flutter.dev/flutter/material/ScrollbarTheme-class.html), отслеживание состояния и возможность навигации перетаскиванием ползунка. Класс контроллера [`PrimaryScrollController`](https://api.flutter.dev/flutter/widgets/PrimaryScrollController-class.html) теперь поддерживает [использование сочетания клавиш для навигации](http://flutter.dev/go/default-scroll-action) из коробки.

![Решение по управлению недвижимостью для Zurich Insurance, созданное компанией Spica Technologies, является отличным примером веб-поддержки бизнес-приложений Flutter, которую можно включить в настольных браузерах.](https://miro.medium.com/max/3200/0*6XtFgsx4cz1OY88N)

Мы также увеличили [плотность пикселей для отображаемого контента по умолчанию](https://github.com/flutter/flutter/issues/43350), поскольку для указателя мыши она необходима, в отличие от тач-устройств. И мы добавили большой набор [систем курсоров](https://github.com/flutter/flutter/issues/60641) в фреймворк для поддержки всех платформ.

Для пользователей с ограниченными возможностями мы расширили используемую семантику для поддержки скринридеров в операционных системах Windows, macOS и ChromeOS. В вебе вторичное DOM-дерево, которое называется [`SemanticsNode`](https://api.flutter.dev/flutter/semantics/SemanticsNode-class.html) генерируется параллельно с DOM-деревом для объекта рендеринга [`RenderObject`](https://api.flutter.dev/flutter/rendering/RenderObject-class.html). Дерево `SemanticsNode` переводит флаги, действия, метки и другие семантические свойства в [ARIA-атрибуты](ttps://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA). Сейчас вы можете использовать [Narrator](https://support.microsoft.com/en-us/windows/complete-guide-to-narrator-e4397a0d-ef4f-b386-d8ae-c172f109bdb1), [VoiceOver](https://www.apple.com/accessibility/vision/), [TalkBack](https://support.google.com/accessibility/android/answer/6007100?hl=en) или [ChromeVox](https://support.google.com/chromebook/answer/7031755?hl=en#:~:text=You%20can%20turn%20ChromeVox%20on,then%20ChromeVox%20will%20start%20speaking.) для навигации внутри Flutter-приложения.

### Экосистема плагинов

И последнее, поддержка веб-платформы была добавлена для наиболее используемых плагинов, обеспечив возможность поддержки веба для существующих приложений на Flutter. [Плагины Flutter](https://pub.dev/) позволяют вашему коду взаимодействовать в нативными библиотеками для платформ, на которых запускается приложение. Когда вы запускаете Flutter-приложение в вебе, вы получаете доступ к библиотекам на JavaScript через плагины.

В период бета-тестирования мы с помощью сообщества обеспечили поддержку веб-платформы в следующих плагинах:
- [image_picker](https://pub.dev/packages/image_picker_for_web);
- [google_maps](https://pub.dev/packages/google_maps);
- [firebase_analytics](https://pub.dev/packages/firebase_analytics);
- [firebase_storage](https://pub.dev/packages/firebase_storage);
- [connectivity](https://pub.dev/packages/experimental_connectivity_web);
- [cloud_firestore](https://pub.dev/packages/cloud_firestore);
- [cloud_functions](https://pub.dev/packages/cloud_functions);
- [cross_file](https://pub.dev/packages/cross_file).

## Что дальше?

Несколько лет назад использовать Flutter в вебе было невозможно на приемлемом уровне качества и производительности. Однако внедрение новых веб-технологий и постоянное развитие платформы позволило нам использовать намного больше низкоуровневых возможностей устройства. С поддержкой веб-платформы, Flutter обеспечивает ожидаемый пользовательский опыт на большинстве устройств.

Многое в этом релизе стало возможным, благодаря предложениям и замечаниям со стороны пользователей фреймворка для веба на этапе бета-тестирования. И поэтому мы благодарим вас! Продвигаясь вперед, мы видим нашу главную цель в том, чтобы как можно быстрее разрешать все проблемы, что позволит нам оставаться сфокусированными на возможностях реализации высококачественных приложений на Flutter для _всех_ целевых платформ.

![Moi Mobiili, современный оператор мобильной виртуальной сети, недавно запустил свое веб-приложение с помощью Flutter.](https://miro.medium.com/max/3200/0*eLfOUS1mLRtcDr4j)

Производительность будет всегда областью, в которую мы готовы вкладываться. Наша цель — уменьшить размер кода и увеличить скорость отображения кадров (fps). Сегодня каждое веб-приложение на Flutter скачивает код движка для рендеринга, без которого не работает. Мы ищем возможности закэшировать часть кода, увеличив скорость загрузки и уменьшив размер скачиваемого бандла. Мы недавно сделали демо-приложение Flutter Gallery, в котором уменьшили размер, используя библиотеки, мы планируем скоро рассказать о том, чему мы научились.

В течение следующих нескольких месяцев мы продолжим улучшать то, что было сделано:

- CanvasKit уже в стабильной ветке, но проблемы еще остались. Например, пока нет [поддержки старых шрифтов](https://github.com/flutter/flutter/issues/74741) для специальных символов и нормальной загрузки картинок, в соответствие с [Cross-Origin Resource Sharing (CORS)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS).
- PWA пока [кэширует все ресурсы](https://github.com/flutter/flutter/issues/75861), поэтому полноценная поддержка работы приложения без сети требует использования [некоторых ручных манипуляций с CanvasKit](https://github.com/flutter/flutter/issues/70101).
- Рендеринг текста и поддержка различных функций, например, полноценной стилизации, остается очень сложной задачей, над которой мы продолжаем работать.
- Экосистема плагинов — это то, над чем мы также продолжаем работать, чтобы пакеты, опубликованные Google, имели больший паритет между мобильными устройствами и вебом.

![Simplebet использовала веб-поддержку Flutter для создания высокоинтерактивных встраиваемых ставок на НФЛ и НБА в рамках существующего набора мобильных приложений Fanduel.](https://miro.medium.com/max/1920/0*O9LlG-FDFRIFAsX0)

## Начните использовать Flutter для веба

С переносимостью Dart, мощью веб-платформы и гибкостью фреймворка Flutter теперь вы можете собрать приложения под iOS, Android и браузер с той же кодовой базой.

Для тех из вас, кто уже имеет готовое веб-приложение на Flutter, можно собрать его, используя [стабильную ветку](https://github.com/flutter/flutter/wiki/Flutter-build-release-channels#stable). Если вы только начинаете, почитайте [flutter.dev/web](http://flutter.dev/web), посмотрите наш [пример](https://flutter.dev/docs/get-started/codelab-web) и [сессию на Flutter Engage](https://youtu.be/HAstl_NkXl0), посвященную веб-платформе.

С нетерпением ждем ваших успехов в применении Flutter для веба!
